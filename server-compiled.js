(()=>{"use strict";const e=require("mongodb"),a=require("express"),n=require("multer"),s=require("path"),t=require("url"),o=(require("os"),require("sanitize-html"));let i;require("process");const r=n(),l=a();l.set("view engine","ejs"),l.set("views","./views");const c=(0,t.fileURLToPath)("file:///D:/Projects/CodeFolder/NODE%20JS/puppy-app/server.js"),d=s.dirname(c);l.use(a.static(s.join(d,"public"))),l.use(a.json()),l.use(a.urlencoded({extended:!1})),l.get("/",(async(e,a)=>{const n=await i.collection("animals").find().toArray();a.render("home",{allAnimals:n})})),l.use(((e,a,n)=>{a.set("WWW-Authenticate","Basic realm='Our MERN App'"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?n():a.status(401).send('\n        <nav>\n          <a href="/">Home</a>\n          <a href="/admin">Admin</a>\n        </nav>\n        Try again\n    ')})),l.get("/admin",((e,a)=>{a.render("admin")})),l.get("/api/animals",(async(e,a)=>{const n=await i.collection("animals").find().toArray();a.json(n)})),l.post("/create-animal",r.single("photo"),(async(e,a,n)=>{"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.species&&(e.body.species=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:o(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),species:o(e.body.species.trim(),{allowedTags:[],allowedAttributes:{}})},n()}),(async(e,a)=>{await i.collection("animals").insertOne(e.cleanData),console.log(e.body),a.send("Thanks You")})),(async()=>{const a=new e.MongoClient("mongodb://localhost:27017/puppy-app");await a.connect(),i=a.db(),l.listen(3e3,(()=>{console.log("http://localhost:3000")}))})()})();